<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today's Word</title>
    <link rel="stylesheet" href="../style/common.css">
    <link rel="stylesheet" href="../style/word.css">
    
    <!-- 🌐 Favicon 설정 -->
    <link rel="icon" href="../favicon/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon/favicon-32x32.png">
    <link rel="apple-touch-icon" href="../favicon/apple-touch-icon.png">
    <link rel="manifest" href="../favicon/site.webmanifest">

    <!-- 🖼 Open Graph (SNS 공유 미리보기) -->
    <meta property="og:title" content="Restart English - Today's Word">
    <meta property="og:description" content="Expand your vocabulary with today's word!">
    <meta property="og:image" content="https://restartenglish.github.io/preview.png">
    <meta property="og:url" content="https://restartenglish.github.io/word.html">
</head>
<body>
    <div class="container">
        <h1>📖 Today's Word</h1>
        
        <div class="word-card">
            <h2 id="content">Loading...</h2>
            <p class="phonetic-container">
                <span id="phonetic-us" class="phonetic" onclick="speakWord('en-US')">🇺🇸 Loading...</span>
                <span id="phonetic-uk" class="phonetic" onclick="speakWord('en-GB')">🇬🇧 Loading...</span>
            </p>
            <p id="definition" class="definition">Meaning: Loading...</p>
            <div class="button-group">
                <button onclick="loadRandom()">🎲 Random</button>
                <button onclick="loadNext()">➡️ Next</button>
                <button onclick="share()">📤 Share</button>
            </div>
        </div>

        <a class="home" href="/">🏠 Back to Home</a>
    </div>

    <script>
        let words = [];
        let voices = [];

        function loadVoices() {
            voices = speechSynthesis.getVoices();
        }
        speechSynthesis.onvoiceschanged = loadVoices;

        async function loadContent() {
            try {
                const response = await fetch("../data/word.txt");
                const text = await response.text();
                words = text.split("\n").filter(w => w.trim() !== "");
                
                const today = new Date();
                const index = today.getUTCFullYear() * 100 + today.getUTCDate();
                displayWord(index % words.length);
            } catch (error) {
                document.getElementById("content").innerText = "Error loading word.";
            }
        }

        async function displayWord(index) {
            const word = words[index];
            document.getElementById("content").innerText = word;
            
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                
                document.getElementById("definition").innerText = "Meaning: " + (data[0]?.meanings[0]?.definitions[0]?.definition || "No definition found.");
                
                const phoneticUS = data.find(d => d.phonetics.some(p => p.audio.includes("us")));
                const phoneticUK = data.find(d => d.phonetics.some(p => p.audio.includes("uk")));
                
                document.getElementById("phonetic-us").innerText = "🇺🇸 " + (phoneticUS?.phonetics.find(p => p.text)?.text || "N/A");
                document.getElementById("phonetic-uk").innerText = "🇬🇧 " + (phoneticUK?.phonetics.find(p => p.text)?.text || "N/A");
            } catch {
                document.getElementById("definition").innerText = "Meaning: No definition found.";
                document.getElementById("phonetic-us").innerText = "🇺🇸 N/A";
                document.getElementById("phonetic-uk").innerText = "🇬🇧 N/A";
            }
        }

        function speakWord(lang) {
            const word = document.getElementById("content").innerText;
            const utterance = new SpeechSynthesisUtterance(word);

            if (lang === "en-US") {
                utterance.voice = voices.find(v => v.lang === "en-US" && v.name.includes("Google")) || voices.find(v => v.lang === "en-US");
            }
            if (lang === "en-GB") {
                utterance.voice = voices.find(v => v.lang === "en-GB" && v.name.includes("Google")) || voices.find(v => v.lang === "en-GB");
            }

            utterance.lang = lang;
            speechSynthesis.speak(utterance);
        }

        function loadRandom() {
            const randomIndex = Math.floor(Math.random() * words.length);
            displayWord(randomIndex);
        }

        function loadNext() {
            let index = words.indexOf(document.getElementById("content").innerText);
            index = (index + 1) % words.length;
            displayWord(index);
        }

        function share() {
            const word = document.getElementById("content").innerText;
            const url = window.location.href;
            const text = `Today's Word: ${word} - Learn more at ${url}`;

            if (navigator.share) {
                navigator.share({ title: "Restart English", text, url });
            } else {
                prompt("Copy this link:", url);
            }
        }

        loadContent();
    </script>
</body>
</html>
